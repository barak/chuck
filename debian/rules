#!/usr/bin/make -f

export DEB_BUILD_MAINT_OPTIONS := hardening=+all
DPKG_EXPORT_BUILDFLAGS = 1
include /usr/share/dpkg/buildflags.mk

export CFLAGS:=$(CPPFLAGS) $(CFLAGS)
export CHUCK_STRICT=1

%:
	dh $@ --sourcedirectory=src

override_dh_auto_build:
	mkdir build
	dh_auto_build -- linux-alsa
	mv src/chuck build/chuck.alsa
	dh_auto_clean
	dh_auto_build -- linux-pulse
	mv src/chuck build/chuck.pulse
	dh_auto_clean
	dh_auto_build -- linux-jack CHUCK_DEBUG=y
	docbook-to-man debian/chuck.sgml > build/chuck.1

execute_after_dh_auto_clean:
	rm -rf build/

override_dh_installchangelogs:
	dh_installchangelogs VERSIONS

override_dh_compress:
	dh_compress -X.wav -X.ck

execute_after_dh_fixperms:
	-find debian/chuck-data/usr/share/doc/chuck-data/examples/ -type f -exec chmod --changes 644 '{}' '+'
