#!/usr/bin/make -f

export DEB_BUILD_MAINT_OPTIONS := hardening=+all
DPKG_EXPORT_BUILDFLAGS = 1
include /usr/share/dpkg/buildflags.mk

%:
	dh $@

override_dh_auto_build:
	mkdir build
	cd src && $(MAKE) linux-alsa
	mv src/chuck build/chuck.alsa
	cd src && $(MAKE) clean
	cd src && $(MAKE) linux-pulse
	mv src/chuck build/chuck.pulse
	cd src && $(MAKE) clean
	cd src && $(MAKE) linux-jack CHUCK_DEBUG=y
	docbook-to-man debian/chuck.sgml > build/chuck.1

override_dh_auto_clean:
	dh_auto_clean
	cd src && $(MAKE) clean
	rm -rf build/

override_dh_auto_install:
	cd src && $(MAKE) install DESTDIR=$(CURDIR)/debian/tmp

override_dh_installchangelogs:
	dh_installchangelogs VERSIONS

override_dh_compress:
	dh_compress -X.wav -X.ck

override_dh_fixperms:
	dh_fixperms
	find debian/chuck-data/usr/share/doc/chuck-data/examples/ -type f | xargs chmod 644

override_dh_missing:
	dh_missing --fail-missing
